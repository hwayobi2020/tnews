{% extends 'base.html' %}

{% block title %}설정 - AI 뉴스 브리핑{% endblock %}

{% block content %}
<div class="user-count">
    <strong>{{ user_count }}명</strong>
    이 뉴스를 받고 있어요
</div>

<div class="card">
    <h1>AI 뉴스 브리핑</h1>
    <p class="subtitle">원하는 키워드와 텔레그램을 연결하세요</p>

    <!-- 연결 상태 -->
    {% if user.chat_id %}
    <div class="status status-connected">
        <span>&#10003;</span> 텔레그램 연결됨
    </div>
    {% else %}
    <div class="status status-pending">
        <span>!</span> 텔레그램 연결이 필요합니다
    </div>
    {% endif %}

    <!-- 키워드 설정 -->
    <form method="POST">
        <div class="form-group">
            <label>뉴스 키워드</label>
            <input type="text" name="keyword" value="{{ user.keyword }}" placeholder="예: 인공지능, 비트코인">
            <p style="font-size: 12px; color: #999; margin-top: 8px;">
                이 키워드로 매일 뉴스를 검색해서 보내드려요
            </p>
        </div>

        <button type="submit" class="btn btn-primary" style="margin-bottom: 20px;">
            키워드 저장
        </button>
    </form>

    <!-- 텔레그램 연결 -->
    <div style="border-top: 1px solid #eee; padding-top: 20px;">
        <label>텔레그램 연결</label>
        {% if user.chat_id %}
        <p style="font-size: 14px; color: #666; margin-bottom: 12px;">
            이미 연결되었습니다! 매일 아침 뉴스를 받게 됩니다.
        </p>
        {% else %}
        <p style="font-size: 14px; color: #666; margin-bottom: 12px;">
            아래 버튼을 클릭해서 텔레그램과 연결하세요.
        </p>
        {% endif %}

        <a href="{{ telegram_link }}" target="_blank" class="btn btn-telegram">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.015-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.008-1.252-.241-1.865-.44-.751-.244-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.015 3.333-1.386 4.025-1.627 4.477-1.635.099-.002.321.023.465.141.121.099.154.232.17.325.015.094.034.31.019.478z"/>
            </svg>
            텔레그램으로 연결하기
        </a>

        <p style="font-size: 12px; color: #999; margin-top: 12px; word-break: break-all;">
            링크: {{ telegram_link }}
        </p>
    </div>

    <!-- 현재 설정 요약 -->
    <div style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;">
        <label>현재 설정</label>
        <p style="font-size: 14px; color: #666;">
            키워드: <span class="keyword-tag">{{ user.keyword }}</span><br>
            상태: {% if user.chat_id %}매일 아침 뉴스 발송 예정{% else %}텔레그램 연결 대기중{% endif %}
        </p>
    </div>

    <!-- 공유 링크 -->
    <div style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;">
        <label>친구에게 공유하기</label>
        <p style="font-size: 14px; color: #666; margin-bottom: 12px;">
            같은 키워드로 뉴스를 받고 싶은 친구에게 이 링크를 보내세요!<br>
            <strong>현재 {{ keyword_users }}명</strong>이 '{{ user.keyword }}' 뉴스를 받고 있어요.
        </p>
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" value="{{ share_link }}" readonly id="share-link"
                   style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 12px;">
            <button onclick="copyShareLink()" class="btn" style="padding: 10px 16px; background: #28a745; color: white;">
                복사
            </button>
        </div>
    </div>
</div>

<script>
function copyShareLink() {
    var copyText = document.getElementById("share-link");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(copyText.value);
    alert("링크가 복사되었습니다!");
}
</script>

<!-- 오늘의 뉴스 요약 -->
{% if news_summary %}
<div class="card" style="margin-top: 20px;">
    <h2 style="margin-bottom: 15px;">오늘의 뉴스 브리핑</h2>
    <div class="news-summary" style="background: #f9f9f9; padding: 20px; border-radius: 10px; white-space: pre-line; line-height: 1.8; font-size: 14px;">
{{ news_summary }}
    </div>
    <p style="font-size: 12px; color: #999; margin-top: 12px;">
        이 내용이 매일 아침 텔레그램으로 발송됩니다.
    </p>
</div>
{% endif %}
{% endblock %}
